<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UD10 - Abilitazioni Macchine: Chi Pu√≤ Guidare Cosa?</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }

        header {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 3px solid #667eea;
            padding-bottom: 20px;
        }

        h1 {
            color: #2d3748;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .scenario {
            background: #f7fafc;
            border-left: 4px solid #667eea;
            padding: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
        }

        .scenario h2 {
            color: #667eea;
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .scenario p {
            color: #4a5568;
            line-height: 1.6;
        }

        .alert-box {
            background: #fff5f5;
            border: 2px solid #fc8181;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .alert-box::before {
            content: "‚ö†Ô∏è";
            font-size: 1.5em;
        }

        .alert-box p {
            color: #742a2a;
            font-weight: 600;
            margin: 0;
        }

        .game-area {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 40px;
            margin-bottom: 30px;
        }

        .operators-section, .machines-section {
            background: #f7fafc;
            padding: 20px;
            border-radius: 12px;
        }

        .section-title {
            font-size: 1.2em;
            color: #2d3748;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .operator-card {
            background: white;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            cursor: grab;
            transition: all 0.3s;
        }

        .operator-card:active {
            cursor: grabbing;
        }

        .operator-card.dragging {
            opacity: 0.5;
            transform: rotate(5deg);
        }

        .operator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.2);
            border-color: #667eea;
        }

        .operator-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .operator-name::before {
            content: "üë∑";
            font-size: 1.3em;
        }

    .qualification {
        font-size: 0.9em;
        padding: 5px 0;
        display: flex;
        align-items: flex-start;
        gap: 8px;
        color: #2d3748; /* Tutte uguali! */
    }

        .machine-slot {
            background: white;
            border: 3px dashed #cbd5e0;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            min-height: 140px;
            transition: all 0.3s;
        }

        .machine-slot.drag-over {
            background: #ebf8ff;
            border-color: #667eea;
            transform: scale(1.02);
        }

        .machine-slot.filled {
            border-style: solid;
            border-color: #48bb78;
            background: #f0fff4;
        }

        .machine-info {
            margin-bottom: 15px;
        }

        .machine-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #2d3748;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .machine-type {
            font-size: 0.9em;
            color: #718096;
        }

        .assigned-operator {
            background: #e6fffa;
            border: 2px solid #38b2ac;
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
        }

        .assigned-operator .name {
            font-weight: bold;
            color: #234e52;
        }

        .remove-btn {
            background: #fc8181;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85em;
            margin-top: 8px;
            transition: background 0.3s;
        }

        .remove-btn:hover {
            background: #f56565;
        }

        .submit-section {
            text-align: center;
            margin-top: 30px;
        }

        .submit-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.1em;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 15px 35px rgba(102, 126, 234, 0.4);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            box-shadow: none;
        }

        .feedback {
            display: none;
            margin-top: 30px;
            padding: 30px;
            border-radius: 12px;
            animation: slideIn 0.5s;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .feedback.show {
            display: block;
        }

        .feedback.perfect {
            background: linear-gradient(135deg, #d4fc79 0%, #96e6a1 100%);
        }

        .feedback.partial {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
        }

        .feedback.poor {
            background: linear-gradient(135deg, #fab1a0 0%, #ff7675 100%);
        }

        .feedback-title {
            font-size: 1.8em;
            font-weight: bold;
            margin-bottom: 15px;
            text-align: center;
        }

        .score {
            font-size: 3em;
            font-weight: bold;
            text-align: center;
            margin: 20px 0;
        }

        .error-list {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .error-item {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #f56565;
            background: #fff5f5;
        }

        .error-item strong {
            color: #c53030;
        }

        .success-item {
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #48bb78;
            background: #f0fff4;
        }

        .success-item strong {
            color: #2f855a;
        }

        .unassigned-machines {
            background: #fffaf0;
            border-left: 4px solid #ed8936;
            padding: 15px;
            margin-top: 15px;
            border-radius: 8px;
        }

        @media (max-width: 1024px) {
            .game-area {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üöú UD10 - Chi Pu√≤ Guidare Cosa?</h1>
            <p style="color: #718096; margin-top: 10px;">Verifica delle abilitazioni operatori secondo Accordo Stato-Regioni 22/02/2012</p>
        </header>

        <div class="scenario">
            <h2>üìã Scenario</h2>
            <p>Sei il <strong>datore di lavoro di EdilCostruzioni S.r.l.</strong> Luned√¨ mattina arrivano in cantiere 5 operatori e devi assegnare le macchine disponibili.</p>
            <p style="margin-top: 10px;"><strong>Prima di autorizzare</strong>, devi verificare che ogni operatore abbia l'abilitazione corretta e valida.</p>
        </div>

        <div class="alert-box">
            <p>Non tutti possono guidare tutte le macchine.</p>
        </div>

        <div class="game-area">
            <div class="operators-section">
                <div class="section-title">üë∑ Operatori Disponibili</div>
                <div id="operatorsList">
                    <!-- Operatori generati dinamicamente -->
                </div>
            </div>

            <div class="machines-section">
                <div class="section-title">üöú Macchine da Assegnare</div>
                <div id="machinesList">
                    <!-- Macchine generate dinamicamente -->
                </div>
            </div>
        </div>

        <div class="submit-section">
            <button class="submit-btn" id="submitBtn">‚úì Verifica Abbinamenti</button>
        </div>

        <div class="feedback" id="feedback">
            <!-- Feedback generato dinamicamente -->
        </div>
    </div>

    <script>
        // Dati operatori
        const operators = [
    {
        id: 'mario',
        name: 'Mario Rossi',
        qualifications: [
            { text: 'Escavatori idraulici < 20 ton', expires: '15/03/2030' },
            { text: 'Pale caricatrici frontali', expires: '15/03/2030' },
            { text: 'Gru mobili autocarrate', expires: '10/11/2024' } // Scaduto ma non dichiarato!
        ]
    },
    {
        id: 'luca',
        name: 'Luca Bianchi',
        qualifications: [
            { text: 'PLE con stabilizzatori', expires: '20/06/2028' },
            { text: 'Carrelli elevatori frontali', expires: '20/06/2028' }
        ]
    },
    {
        id: 'giuseppe',
        name: 'Giuseppe Verdi',
        qualifications: [
            { text: 'Gru a torre a rotazione in basso', expires: '12/01/2029' },
            { text: 'Aggiornamento quinquennale', expires: '15/05/2024' } // Scaduto!
        ]
    },
    {
        id: 'anna',
        name: 'Anna Neri',
        qualifications: [
            { text: 'Escavatori idraulici > 20 ton', expires: '05/09/2029' },
            { text: 'Terne', expires: '05/09/2029' }
        ]
    },
    {
        id: 'paolo',
        name: 'Paolo Gialli',
        qualifications: [
            { text: 'PLE senza stabilizzatori', expires: '18/12/2027' },
            { text: 'Carrelli elevatori semoventi a braccio telescopico', expires: '18/12/2027' }
        ]
    }
];

        // Dati macchine
        const machines = [
            {
                id: 'escavatore',
                name: 'üèóÔ∏è Escavatore Caterpillar 320D',
                type: '(22 tonnellate)',
                correctOperator: 'anna'
            },
            {
                id: 'ple',
                name: 'üìê Piattaforma JLG 450AJ',
                type: '(con stabilizzatori)',
                correctOperator: 'luca'
            },
            {
                id: 'gru',
                name: 'üèóÔ∏è Gru a torre Potain MD189',
                type: '(rotazione in basso)',
                correctOperator: null // Rimane ferma
            },
            {
                id: 'pala',
                name: 'üöú Pala gommata Volvo L60H',
                type: '(caricatore frontale)',
                correctOperator: 'mario'
            },
            {
                id: 'telescopico',
                name: 'üì¶ Carrello Manitou MT625',
                type: '(elevatore telescopico)',
                correctOperator: 'paolo'
            }
        ];

        // Stato del gioco
        let assignments = {};

        // Inizializza il gioco
        function initGame() {
            renderOperators();
            renderMachines();
            setupDragAndDrop();
        }

        // Renderizza operatori
       function renderOperators() {
    const container = document.getElementById('operatorsList');
    container.innerHTML = operators.map(op => `
        <div class="operator-card" draggable="true" data-operator-id="${op.id}">
            <div class="operator-name">${op.name}</div>
            ${op.qualifications.map(q => `
                <div class="qualification">
                    ${q.text} - Scad. ${q.expires}
                </div>
            `).join('')}
        </div>
    `).join('');
}

        // Renderizza macchine
        function renderMachines() {
            const container = document.getElementById('machinesList');
            container.innerHTML = machines.map(m => `
                <div class="machine-slot" data-machine-id="${m.id}">
                    <div class="machine-info">
                        <div class="machine-name">${m.name}</div>
                        <div class="machine-type">${m.type}</div>
                    </div>
                    <div class="drop-zone" data-machine-id="${m.id}">
                        <em style="color: #a0aec0;">Trascina qui l'operatore</em>
                    </div>
                </div>
            `).join('');
        }

        // Setup Drag and Drop
        function setupDragAndDrop() {
            const operatorCards = document.querySelectorAll('.operator-card');
            const dropZones = document.querySelectorAll('.machine-slot');

            operatorCards.forEach(card => {
                card.addEventListener('dragstart', handleDragStart);
                card.addEventListener('dragend', handleDragEnd);
            });

            dropZones.forEach(zone => {
                zone.addEventListener('dragover', handleDragOver);
                zone.addEventListener('drop', handleDrop);
                zone.addEventListener('dragleave', handleDragLeave);
            });
        }

        let draggedOperator = null;

        function handleDragStart(e) {
            draggedOperator = e.target.dataset.operatorId;
            e.target.classList.add('dragging');
        }

        function handleDragEnd(e) {
            e.target.classList.remove('dragging');
        }

        function handleDragOver(e) {
            e.preventDefault();
            e.currentTarget.classList.add('drag-over');
        }

        function handleDragLeave(e) {
            e.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(e) {
            e.preventDefault();
            e.currentTarget.classList.remove('drag-over');
            
            const machineId = e.currentTarget.dataset.machineId;
            const operator = operators.find(op => op.id === draggedOperator);
            
            // Rimuovi eventuale assegnazione precedente di questo operatore
            Object.keys(assignments).forEach(key => {
                if (assignments[key] === draggedOperator) {
                    delete assignments[key];
                }
            });
            
            // Assegna nuovo operatore
            assignments[machineId] = draggedOperator;
            
            updateMachineDisplay(machineId, operator);
            updateOperatorAvailability();
        }

        function updateMachineDisplay(machineId, operator) {
            const slot = document.querySelector(`.machine-slot[data-machine-id="${machineId}"]`);
            const dropZone = slot.querySelector('.drop-zone');
            
            slot.classList.add('filled');
            dropZone.innerHTML = `
                <div class="assigned-operator">
                    <div class="name">‚úì ${operator.name}</div>
                    <button class="remove-btn" onclick="removeAssignment('${machineId}')">‚úó Rimuovi</button>
                </div>
            `;
        }

        function removeAssignment(machineId) {
            delete assignments[machineId];
            const slot = document.querySelector(`.machine-slot[data-machine-id="${machineId}"]`);
            const dropZone = slot.querySelector('.drop-zone');
            
            slot.classList.remove('filled');
            dropZone.innerHTML = '<em style="color: #a0aec0;">Trascina qui l\'operatore</em>';
            updateOperatorAvailability();
        }

        function updateOperatorAvailability() {
            const assignedOperators = Object.values(assignments);
            document.querySelectorAll('.operator-card').forEach(card => {
                const operatorId = card.dataset.operatorId;
                if (assignedOperators.includes(operatorId)) {
                    card.style.opacity = '0.4';
                    card.style.pointerEvents = 'none';
                } else {
                    card.style.opacity = '1';
                    card.style.pointerEvents = 'auto';
                }
            });
        }

        // Verifica abbinamenti
        document.getElementById('submitBtn').addEventListener('click', function() {
            const results = checkAssignments();
            displayFeedback(results);
        });

        function checkAssignments() {
            let correct = 0;
            let errors = [];
            let unassigned = [];

            machines.forEach(machine => {
                const assignedOperator = assignments[machine.id];
                
                if (!assignedOperator && machine.correctOperator === null) {
                    // Corretto: macchina non assegnata quando non dovrebbe esserlo
                    correct++;
                } else if (assignedOperator === machine.correctOperator) {
                    // Corretto: operatore giusto
                    correct++;
                } else {
                    // Errore
                    if (!assignedOperator) {
                        unassigned.push(machine);
                    } else {
                        const operator = operators.find(op => op.id === assignedOperator);
                        errors.push({
                            machine: machine,
                            assignedOperator: operator,
                            correctOperator: machine.correctOperator ? operators.find(op => op.id === machine.correctOperator) : null
                        });
                    }
                }
            });

            return { correct, total: machines.length, errors, unassigned };
        }

        function displayFeedback(results) {
            const feedback = document.getElementById('feedback');
            const percentage = (results.correct / results.total) * 100;
            
            let feedbackClass = 'poor';
            let feedbackTitle = '‚ùå Da Rivedere';
            let feedbackMessage = 'Ci sono ancora errori significativi nella gestione delle abilitazioni.';
            
            if (percentage === 100) {
                feedbackClass = 'perfect';
                feedbackTitle = 'üéâ Perfetto!';
                feedbackMessage = 'Hai verificato correttamente tutte le abilitazioni!';
            } else if (percentage >= 60) {
                feedbackClass = 'partial';
                feedbackTitle = '‚ö†Ô∏è Quasi!';
                feedbackMessage = 'Buon lavoro, ma ci sono ancora alcuni errori da correggere.';
            }
            
            feedback.className = `feedback ${feedbackClass} show`;
            
            let html = `
                <div class="feedback-title">${feedbackTitle}</div>
                <div class="score">${results.correct}/${results.total}</div>
                <p style="text-align: center; font-size: 1.1em; margin-bottom: 20px;">${feedbackMessage}</p>
            `;
            
            if (results.errors.length > 0) {
                html += '<div class="error-list">';
                html += '<h3 style="margin-bottom: 15px; color: #c53030;">üî¥ Errori commessi:</h3>';
                
                results.errors.forEach(error => {
                    let explanation = '';
                    
                    // Logica di feedback personalizzata
                    if (error.machine.id === 'escavatore' && error.assignedOperator.id === 'mario') {
                        explanation = 'Mario ha patentino per escavatori < 20 ton, ma il Caterpillar 320D pesa 22 ton. Serve abilitazione > 20 ton (Anna Neri).';
                    } else if (error.machine.id === 'gru' && error.assignedOperator.id === 'giuseppe') {
                        explanation = 'Anche se il patentino √® tecnicamente valido, l\'aggiornamento quinquennale √® scaduto da 6 mesi. Giuseppe non pu√≤ operare fino al rinnovo.';
                    } else if (error.machine.id === 'ple' && error.assignedOperator.id === 'paolo') {
                        explanation = 'Paolo ha patentino PLE SENZA stabilizzatori, ma la JLG 450AJ ha stabilizzatori. Serve Luca Bianchi.';
                    } else if (error.machine.id === 'telescopico' && error.assignedOperator.id === 'luca') {
                        explanation = 'Luca ha patentino carrelli frontali, NON telescopici. Serve Paolo Gialli.';
                    } else if (error.machine.id === 'pala' && error.assignedOperator.id !== 'mario') {
                        explanation = 'Solo Mario Rossi ha il patentino per pale caricatrici frontali valido.';
                    } else {
                        explanation = 'Questo abbinamento non rispetta le abilitazioni richieste dall\'Accordo Stato-Regioni.';
                    }
                    
                    html += `
                        <div class="error-item">
                            <strong>${error.assignedOperator.name} ‚Üí ${error.machine.name}</strong><br>
                            ${explanation}
                        </div>
                    `;
                });
                
                html += '</div>';
            }
            
            if (results.unassigned.length > 0) {
                html += `
                    <div class="unassigned-machines">
                        <strong>üü° Macchine non assegnate:</strong><br>
                        ${results.unassigned.map(m => m.name).join(', ')}
                    </div>
                `;
            }
            
            // Feedback positivi
            if (results.correct > 0) {
                html += '<div class="error-list" style="margin-top: 20px;">';
                html += '<h3 style="margin-bottom: 15px; color: #2f855a;">‚úÖ Abbinamenti corretti:</h3>';
                
                machines.forEach(machine => {
                    const assignedOperator = assignments[machine.id];
                    if (assignedOperator === machine.correctOperator || (!assignedOperator && machine.correctOperator === null)) {
                        const operator = assignedOperator ? operators.find(op => op.id === assignedOperator) : null;
                        
                        let message = '';
                        if (machine.id === 'gru' && !assignedOperator) {
                            message = 'Corretto: la gru resta ferma perch√© Giuseppe Verdi ha l\'aggiornamento scaduto.';
                        } else if (operator) {
                            message = `${operator.name} ha l'abilitazione corretta e valida.`;
                        }
                        
                        html += `
                            <div class="success-item">
                                <strong>${operator ? operator.name : 'Nessuno'} ‚Üí ${machine.name}</strong><br>
                                ${message}
                            </div>
                        `;
                    }
                });
                
                html += '</div>';
            }
            
            feedback.innerHTML = html;
            feedback.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        // Inizializza al caricamento
        initGame();
    </script>
</body>
</html>
